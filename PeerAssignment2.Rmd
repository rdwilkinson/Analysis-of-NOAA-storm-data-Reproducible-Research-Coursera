---
title: "PeerAssignment2"
author: "Richard D. Wilkinson"
date: "03/11/2020"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Synopsis


# Data processing
## Pre-processing
Check if the dataset is already available in the adequate folder, otherwise create this and download it.
```{r}
if (!dir.exists(file.path("data"))) {
  dir.create(file.path("data"))
} 

if (!file.exists("data/StormData.csv.bz2")) {
  download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", "data/StormData.csv.bz2")
}
```

Load the data into the environment.
```{r}
stormData <- read.csv("data/StormData.csv.bz2", header = TRUE, sep = ",")
head(stormData)
```

Get an idea of how the dataset is structured.
```{r}
names(stormData)
head(stormData)
```
Keep the variables of interest for the analysis and make sure they are of the correct type (switch the event type variable to a factor).
```{r}
newStormData <- stormData[, c("REFNUM", "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP", "CROPDMG", "CROPDMGEXP",  "EVTYPE", "BGN_DATE")]

for (i in 1:dim(newStormData)[2]) {
  str(newStormData[i])
}

stormData$EVTYPE <- as.factor(stormData$EVTYPE)
```

### Do we have event types for every year in the dataset?
The date is not in a format that is recognisable by R. Let's strip the year from the BGN_DATE variable.

```{r}
head(newStormData)

library(tidyverse)

newStormData$newDate <- str_split_fixed(newStormData$BGN_DATE, " ", 2)[, 1]
newStormData$newYear <- str_split_fixed(newStormData$newDate, "/", 3)[, 3]

missingEventTypes <- newStormData %>%
  group_by(newYear) %>%
  summarise(SumEventTypes = sum(is.na(EVTYPE)))

head(missingEventTypes)
```
There are no years with missing event types.

### What level of consistency was achieved in the categorisation of the events?
```{r}
head(unique(newStormData$EVTYPE))
```

There are 985 different types of storm events. Some of these categories could be collapsed (e.g. "FLASH FLOOD LANDSLIDES" & "FLASH FLOOD/LANDSLIDE"). Others are not actually storm types (e.g. "Summary of March 14"). It is assumed that more catastrophic events will have been coded more consistently, so event categories are not collapsed here. Nevertheless, event types labelled as "summaries" are removed from the dataset.
```{r}

```


## Analysis

```{r}

```



# Results